function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c(e);if(t){var o=c(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return l(this,n)}}function f(){return(f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)}var h={ext:function(e){for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},warn:function(){var t="object"==("undefined"==typeof console?"undefined":e(console))?console.warn:noop;try{var n={warn:t};n.warn.call(n)}catch(e){return noop}return t},encode:function(e,t){try{e=t?encodeURIComponent(e).replace(/\(/g,"%28").replace(/\)/g,"%29"):encodeURIComponent(e)}catch(e){}return e},replaceAll:function(e,t,n){return e.replace(new RegExp(t,"g"),n)},generateUUID:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))},dateFormat:function(e,t){if(!(e&&e instanceof Date))return"";var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t},__assign:f},d=function(){function e(n){t(this,e),this.api="/api/save/log",this.baseUrl=n,this.requestQueue=[],this.requestTimmer=void 0,this.synRequestNum=4,this.synNum=0,this.retryNum=1}return r(e,[{key:"pushToQueue",value:function(e){var t=this;return this.requestQueue.push(e),this.onReady((function(){t.requestTimmer=t.delay((function(){t.clear()}),t.requestQueue[0]&&t.requestQueue[0].logError&&t.requestQueue[0].logError>0?3e3:-1)}))}},{key:"onReady",value:function(e){"function"==typeof e&&e&&e()}},{key:"delay",value:function(e,t){return e||"function"==typeof e?-1===t?(e(),null):setTimeout(e,t||0):null}},{key:"clear",value:function(){var e,t=this;if(this.synNum>this.synRequestNum)return clearTimeout(this.requestTimmer),this.requestTimmer=setTimeout((function(){t.clear()}),50);for(clearTimeout(this.requestTimmer),this.requestTimmer=null;this.synNum<this.synRequestNum&&(e=this.requestQueue.pop());this.synNum++)this.handleLog(e);this.requestQueue.length&&(this.requestTimmer=setTimeout((function(){t.clear()}),50))}},{key:"clearAll",value:function(){this.requestQueue=[],this.requestTimmer=null,this.synNum=0}},{key:"reduceSynNumFun",value:function(){}},{key:"handleLog",value:function(e){var t=this,n=JSON.parse(JSON.stringify(e));try{this._fetch(n).then((function(e){t.reduceSynNumFun()}))}catch(e){this.reduceSynNumFun()}}}]),e}(),y=function(e){s(o,d);var n=p(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"reduceSynNumFun",value:function(){return o.instance.synNum--,this}},{key:"_fetch",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(n){wx.request({url:"".concat(e.baseUrl).concat(e.api),data:t,method:"POST",dataType:"json",fail:function(e){},complete:function(e){n()}})}))}}],[{key:"getInstance",value:function(e){return o.instance||(o.instance=new o(e)),o.instance}}]),o}(),m=["request"],g=["onError"],v=["onLoad"],b="touchmove",w="tap",O={},S={},x={};function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e)switch(t){case"app":S[e.type]=S[e.type]||[],S[e.type].push(e.callback);break;case"page":x[e.type]=S[e.type]||[],x[e.type].push(e.callback);break;default:O[e.type]=O[e.type]||[],O[e.type].push(e.callback)}}function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";switch(n){case"app":if(!e||!S[e])return;S[e].forEach((function(e){e(t)}));break;case"page":if(!e||!x[e])return;x[e].forEach((function(e){e(t)}));break;default:if(!e||!O[e])return;O[e].forEach((function(e){e(t)}))}}function P(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t in e||r){var o=e[t],i=n(o);"function"==typeof i&&(e[t]=i)}}var T=function(e,t){var n=!0;return function(){if(n){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];e.apply(this,o),n=!1,setTimeout((function(){n=!0}),t)}}},_=Object.prototype.toString;function j(e){return function(t){return _.call(t)==="[object "+e+"]"}}var M={isNumber:j("Number"),isString:j("String"),isBoolean:j("Boolean"),isNull:j("Null"),isUndefined:j("Undefined"),isSymbol:j("Symbol"),isFunction:j("Function"),isObject:j("Object"),isArray:j("Array"),isProcess:j("process"),isWindow:j("Window")};function k(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.addEventListener(t,n,r)}function E(e){switch(_.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return function(e,t){try{return e instanceof t}catch(e){return!1}}(e,Error)}}function q(){return(new Date).getTime()}function R(e){return Number(e.split(".")[0])}function A(){return getCurrentPages()[getCurrentPages().length-1].__route__}var I="page_pv",V="http_log",$={onError:function(e){try{if(!this.wxMonitor)return;var t=this.wxMonitor,n={simpleUrl:A(),errorMessage:String(e)};t.logSave("js_error",n)}catch(e){}}},C={onLoad:function(){try{if(!this.wxMonitor)return;var e=this.wxMonitor,t=A(),n={simpleUrl:t,referrer:e.referrerPage||""};e.logSave(I,n),e.referrerPage=t}catch(e){}}};function D(e,t){U(e,t)}function J(e){if(Page){C.wxMonitor=e;var t=Page;Page=function(e){var n=v;n.forEach((function(t){D({callback:function(e){return C[t.replace("PageOn","on")](e)},type:t},"page"),P(e,t.replace("PageOn","on"),(function(e){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];N.apply(null,[t].concat(r,["page"])),e&&e.apply(this,r)}}),!0)}));var r=T((function(e){e.mitoProcessed=!0,console.log("测试点击封装"),console.log(e)}),500),o=[b,w];return Object.keys(e).forEach((function(t){var i;"function"!=typeof e[t]||(i=t,n.find((function(e){return e.replace("PageOn","on")===i})))||P(e,t,(function(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var a=n[0];a&&a.type&&a.currentTarget&&!a.mitoProcessed&&o.indexOf(a.type)&&r(a),e.apply(this,n)}}),!0)})),t.call(this,e)}}}function H(e){J(e),function(e){if(App){$.wxMonitor=e;var t=App;App=function(e){return g.forEach((function(t){D({callback:function(e){return $[t.replace("AppOn","on")](e)},type:t},"app"),P(e,t.replace("AppOn","on"),(function(e){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];N.apply(null,[t].concat(r,["app"])),e&&e.apply(this,r)}}),!0)})),t(e)}}}(e),function(e){var t=e;m.forEach((function(e){var n=wx[e];Object.defineProperty(wx,e,{writable:!0,enumerable:!0,configurable:!0,value:function(){for(var r=[],o=q(),i=0;i<arguments.length;i++)r[i]=arguments[i];var a=r[0],s=a.url||"";"request"===e&&a.data;var c=function(e){try{if(e&&200!=e.statusCode){var n={simpleUrl:A(),httpUrl:a.url||"",httpUploadType:2,responseText:JSON.stringify(e),httpStatus:e.statusCode};s&&s!="".concat(t.queue.baseUrl).concat(t.queue.api)&&t.logSave(V,n)}else{var r=q(),i={simpleUrl:A(),loadTime:r-o,httpUrl:a.url||"",httpUploadType:1,responseText:JSON.stringify(e),httpStatus:e.statusCode||200};s&&s!="".concat(t.queue.baseUrl).concat(t.queue.api)&&t.logSave(V,i)}}catch(e){h.warn("[cloudMonitor] http error")}if("function"==typeof a.success)return a.success(e)},u=function(e){try{var n={simpleUrl:A(),httpUrl:a.url||"",httpUploadType:2,responseText:JSON.stringify(e),httpStatus:"0"};s&&s!="".concat(t.queue.baseUrl).concat(t.queue.api)&&t.logSave(V,n)}catch(e){h.warn("[cloudMonitor] http error")}if("function"==typeof a.fail)return a.fail(e)},l=h.__assign(h.__assign({},a),{success:c,fail:u});return n.call(this,l)}})}))}(e)}var L={baseUrl:"",autoReportApi:!0,autoReportPage:!0,autoReportPagePerformance:!0};var F=["onError"],Q=["onLoad"],B=["request"],K="touchmove",Y="tap",W="UNKNOWN",X="UNKNOWN_FUNCTION",z="PROMISE_ERROR";function G(){return"undefined"==typeof document||null==document.location?"":document.location.href}function Z(e){var t={name:e.name,message:e.message};if(void 0===e.stack||!e.stack)return t;for(var n,r,o,i=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,s=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,c=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,u=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,l=/\((\S*)(?::(\d+))(?::(\d+))\)/,p=e.stack.split("\n"),f=[],h=0,d=p.length;h<d;++h){if(r=i.exec(p[h])){var y=r[2]&&0===r[2].indexOf("native");r[2]&&0===r[2].indexOf("eval")&&(n=l.exec(r[2]))&&(r[2]=n[1],r[3]=n[2],r[4]=n[3]),o={url:y?null:r[2],func:r[1]||X,args:y?[r[2]]:[],line:r[3]?+r[3]:null,column:r[4]?+r[4]:null}}else if(r=c.exec(p[h]))o={url:r[2],func:r[1]||X,args:[],line:+r[3],column:r[4]?+r[4]:null};else{if(!(r=s.exec(p[h])))continue;r[3]&&r[3].indexOf(" > eval")>-1&&(n=u.exec(r[3]))?(r[3]=n[1],r[4]=n[2],r[5]=null):0!==h||r[5]||void 0===e.columnNumber||(f[0].column=e.columnNumber+1),o={url:r[3],func:r[1]||X,args:r[2]?r[2].split(","):[],line:r[4]?+r[4]:null,column:r[5]?+r[5]:null}}!o.func&&o.line&&(o.func=X),f.push(o)}return f.length?a(a({},t),{},{stack:f}):null}var ee={img:"img",script:"script",link:"link"};function te(e){if(!e)return{};var t=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};var n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],relative:t[5]+n+r}}function ne(e){e.optionsInit=function(e){var t=this;switch(t.SOURCE_TYPE){case 2:wx.getSystemInfo({success:function(n){t.baseOptions={app:e.app||"",type:2,projectVersion:e.projectVersion||"1.0.0",customerKey:h.generateUUID(),os:-1===n.system.indexOf("iOS")?"Android":"IOS",deviceName:n.model,brand:n.brand,browserVersion:n.version}}});break;case 3:my.getSystemInfo({success:function(n){t.baseOptions={app:e.app||"",type:3,projectVersion:e.projectVersion||"1.0.0",customerKey:h.generateUUID(),os:"iOS"===n.platform?"IOS":"Android",deviceName:n.model,brand:n.brand,browserVersion:n.version}}});break;case 1:var n=function(){var e={},t=navigator.userAgent,n=t.match(/(Android);?[\s\/]+([\d.]+)?/),r=t.match(/(iPad).*OS\s([\d_]+)/),o=t.match(/(iPod)(.*OS\s([\d_]+))?/),i=!r&&t.match(/(iPhone\sOS)\s([\d_]+)/),a=t.match(/Android\s[\S\s]+Build\//);if(n&&(e.os="android",e.osVersion=n[2],e.android=!0,e.androidChrome=0<=t.toLowerCase().indexOf("chrome")),(r||i||o)&&(e.os="ios",e.ios=!0),i&&!o&&(e.osVersion=i[2].replace(/_/g,"."),e.iphone=!0),r&&(e.osVersion=r[2].replace(/_/g,"."),e.ipad=!0),o&&(e.osVersion=o[3]?o[3].replace(/_/g,"."):null,e.iphone=!0),e.ios&&e.osVersion&&0<=t.indexOf("Version/")&&"10"===e.osVersion.split(".")[0]&&(e.osVersion=t.toLowerCase().split("version/")[1].split(" ")[0]),e.iphone){e.deviceName="iphone";var s=window.screen.width,c=window.screen.height;320===s&&480===c?e.deviceName="iphone 4":320===s&&568===c?e.deviceName="iphone 5/SE":375===s&&667===c?e.deviceName="iphone 6/7/8":414===s&&736===c?e.deviceName="iphone 6/7/8 Plus":375===s&&812===c&&(e.deviceName="iphone X/S/Max")}else if(e.ipad)e.deviceName="ipad";else if(a){var u=a[0].split(";")[1].replace(/Build\//g,"");e.deviceName=u.replace(/(^\s*)|(\s*$)/g,"")}if(-1==t.indexOf("Mobile")){var l=navigator.userAgent.toLowerCase();if(e.browserName="未知",0<l.indexOf("msie")){var p=l.match(/msie [\d.]+;/gi)[0];e.browserName=p.split("/")[0],e.browserVersion=p.split("/")[1]}0<l.indexOf("firefox")&&(p=l.match(/firefox\/[\d.]+/gi)[0],e.browserName=p.split("/")[0],e.browserVersion=p.split("/")[1]),0<l.indexOf("safari")&&l.indexOf("chrome")<0&&(p=l.match(/safari\/[\d.]+/gi)[0],e.browserName=p.split("/")[0],e.browserVersion=p.split("/")[1]),0<l.indexOf("chrome")&&(p=l.match(/chrome\/[\d.]+/gi)[0],e.browserName=p.split("/")[0],e.browserVersion=p.split("/")[1])}return e.webView=(i||r||o)&&t.match(/.*AppleWebKit(?!.*Safari)/i),e}();t.baseOptions={app:e.app||"",type:1,projectVersion:e.projectVersion||"1.0.0",customerKey:h.generateUUID(),os:"ios"===n.os?"IOS":"Android",deviceName:n.deviceName||"",brand:n.os+(n.osVersion?" "+n.osVersion:""),browserVersion:n.osVersion}}}}function re(e){this.queue.pushToQueue(e)}function oe(e){e.logSave=function(e,t){var n,r=this,o=JSON.parse(JSON.stringify(t)),i=this;if(!i.baseOptions)return i.optionsInit(i.$options),void setTimeout((function(){r.logSave(e,t)}),500);switch(e){case I:case"js_error":case V:case"resource_load":(n=Object.assign(o,i.baseOptions)).userId=i.userId||"",n.uploadType=e,n.mobileTime=h.dateFormat(new Date,"yyyy-MM-dd hh:mm:ss"),i.queue.pushToQueue(n)}}}function ie(e){if(E(e)){var t=Z(e);t.type="reactError";var n={simpleUrl:G(),errorMessage:String(JSON.stringify(t))};vm.logSave(V,n)}else console.warn("传入的react error不是一个object Error")}function ae(e,t,n,r,o){var i=null==o?void 0:o.version,s={type:"vueError",message:"".concat(t.message,"(").concat(r,")"),name:t.name,stack:t.stack||[]};if(M.isString(i))switch(console.log("getBigVersion",R(i)),R(i)){case 2:data=a(a({},s),function(e){var t="";if(e.$root===e)t="root";else{var n=e._isVue?e.$options&&e.$options.name||e.$options&&e.$options._componentTag:e.name;t=(n?"component <"+n+">":"anonymous component")+(e._isVue&&e.$options&&e.$options.__file?" at "+(e.$options&&e.$options.__file):"")}return{componentName:t,propsData:e.$options&&e.$options.propsData}}(n));break;case 3:data=a(a({},s),function(e){var t="";if(e.$root===e)t="root";else{console.log(e.$options);var n=e.$options&&e.$options.name;t=n?"component <"+n+">":"anonymous component"}return{componentName:t,propsData:e.$props}}(n));break;default:return}var c={simpleUrl:G(),errorMessage:String(s)};e&&e.logSave("js_error",c)}var se={install:function(e){if(e&&e.config){var t=this;e.config.errorHandle=function(n,r,o){ae.apply(null,[t,n,r,o,e])}}}};function ce(e){e.setUserId=function(e){this.userId=e},e.errorBoundaryReport=ie,e.MitoVue=se,e.log=re}var ue={};function le(){return getCurrentPages()[getCurrentPages().length-1].route||""}ue.init=function(e){this._init(e)},function(e){e._init=function(t){var n=this;t&&t.app||h.warn("[cloudMonitor] not set app"),t&&t.baseUrl||h.warn("[cloudMonitor] not set baseUrl");var r=Object.assign(L,t);n.$options=r,n.queue=y.getInstance(r.baseUrl),n.baseOptions="",n.referrerPage="",n.userId="",n.SOURCE_TYPE=2,n.optionsInit(r),H(e)}}(ue),ne(ue),oe(ue),ce(ue);var pe={onError:function(e){try{if(!this.aliMonitor)return;var t=this.aliMonitor,n={simpleUrl:le(),errorMessage:String(e)};t.logSave("js_error",n)}catch(e){}}},fe={onLoad:function(){try{if(!this.aliMonitor)return;var e=this.aliMonitor,t=le(),n={simpleUrl:t,referrer:e.referrerPage||""};e.logSave(I,n),e.referrerPage=t}catch(e){}}};function he(e,t){U(e,t)}function de(e){if(Page){fe.aliMonitor=e;var t=Page;Page=function(e){var n=Q;n.forEach((function(t){he({callback:function(e){return fe[t.replace("PageOn","on")](e)},type:t},"page"),P(e,t.replace("PageOn","on"),(function(e){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];N.apply(null,[t].concat(r,["page"])),e&&e.apply(this,r)}}),!0)}));var r=T((function(e){e.mitoProcessed=!0,console.log("测试点击封装"),console.log(e)}),500),o=[K,Y];return Object.keys(e).forEach((function(t){var i;"function"!=typeof e[t]||(i=t,n.find((function(e){return e.replace("PageOn","on")===i})))||P(e,t,(function(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var a=n[0];a&&a.type&&a.currentTarget&&!a.mitoProcessed&&o.indexOf(a.type)&&r(a),e.apply(this,n)}}),!0)})),t.call(this,e)}}}function ye(e){de(e),function(e){if(App){pe.aliMonitor=e;var t=App;App=function(e){return F.forEach((function(t){he({callback:function(e){return pe[t.replace("AppOn","on")](e)},type:t},"app"),P(e,t.replace("AppOn","on"),(function(e){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];N.apply(null,[t].concat(r,["app"])),e&&e.apply(this,r)}}),!0)})),t(e)}}}(e),function(e){var t=e;B.forEach((function(e){var n=my[e];Object.defineProperty(my,e,{writable:!0,enumerable:!0,configurable:!0,value:function(){for(var r=[],o=q(),i=0;i<arguments.length;i++)r[i]=arguments[i];var a=r[0],s=a.url||"";"request"===e&&a.data;var c=function(e){try{if(e&&200!=e.status){var n={simpleUrl:le(),httpUrl:a.url||"",httpUploadType:2,responseText:JSON.stringify(e),httpStatus:e.status};s&&s!="".concat(t.queue.baseUrl).concat(t.queue.api)&&t.logSave(V,n)}else{var r=q(),i={simpleUrl:le(),loadTime:r-o,httpUrl:a.url||"",httpUploadType:1,responseText:JSON.stringify(e),httpStatus:e.status||200};s&&s!="".concat(t.queue.baseUrl).concat(t.queue.api)&&t.logSave(V,i)}}catch(e){h.warn("[cloudMonitor] http error")}if("function"==typeof a.success)return a.success(e)},u=function(e){try{var n={simpleUrl:le(),httpUrl:a.url||"",httpUploadType:2,responseText:JSON.stringify(e),httpStatus:"0"};s&&s!="".concat(t.queue.baseUrl).concat(t.queue.api)&&t.logSave(V,n)}catch(e){h.warn("[cloudMonitor] http error")}if("function"==typeof a.fail)return a.fail(e)},l=h.__assign(h.__assign({},a),{success:c,fail:u});return n.call(this,l)}})}))}(e)}var me=function(e){s(o,d);var n=p(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"reduceSynNumFun",value:function(){return o.instance.synNum--,this}},{key:"_fetch",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(n){my.request({url:"".concat(e.baseUrl).concat(e.api),data:t,method:"POST",dataType:"json",fail:function(e){},complete:function(e){n()}})}))}}],[{key:"getInstance",value:function(e){return o.instance||(o.instance=new o(e)),o.instance}}]),o}(),ge={baseUrl:"",autoReportApi:!0,autoReportPage:!0,autoReportPagePerformance:!0};var ve={init:function(e){this._init(e)}};(function(e){e._init=function(t){var n=this;t&&t.app||h.warn("[cloudMonitor] not set app"),t&&t.baseUrl||h.warn("[cloudMonitor] not set baseUrl");var r=Object.assign(ge,t);n.$options=r,n.queue=me.getInstance(r.baseUrl),n.baseOptions="",n.referrerPage="",n.userId="",n.SOURCE_TYPE=3,n.optionsInit(r),ye(e)}})(ve),ne(ve),oe(ve),ce(ve);var be,we={handleHttp:function(e){if(this.webMonitor){var t=this.webMonitor,n="",r=e.url||"";e&&200!=e.status&&(n={simpleUrl:G(),httpUrl:e.url||"",httpUploadType:2,responseText:JSON.stringify(e.responseText||""),httpStatus:e.status||0})&&r&&r!="".concat(t.queue.baseUrl).concat(t.queue.api)&&t.logSave(V,n),e&&200==e.status&&(n={simpleUrl:G(),loadTime:e.elapsedTime||0,httpUrl:e.url||"",httpUploadType:1,responseText:JSON.stringify(e.responseText||""),httpStatus:e.status||200}),n&&r&&r!="".concat(t.queue.baseUrl).concat(t.queue.api)&&t.logSave(V,n)}},handleError:function(e){if(this.webMonitor){var t=this.webMonitor;if(e.target.localName){var n=function(e){return{simpleUrl:G(),sourceUrl:"资源地址: "+(e.src&&e.src.slice(0,100)||e.href&&e.href.slice(0,100)),elementType:"".concat(ee[e.localName]||e.localName||"")}}(e.target);t.logSave("resource_load",n)}else{var r,o=e.message,i=e.lineno,a=e.colno,s=e.error;s&&E(s)&&(r=Z(s)),r||(r=we.handleNotErrorInstance(o,i,a));var c={simpleUrl:G(),errorMessage:String(JSON.stringify(r))};t.logSave("js_error",c)}}},handleNotErrorInstance:function(e,t,n){var r=W,o=e,i=e.match(ERROR_TYPE_RE);i[1]&&(r=i[1],o=i[2]);var a={func:X,args:W,line:t,col:n};return{name:r,message:o,level:Severity.Normal,time:getTimestamp(),stack:[a]}},handleHistory:function(e){this.savePv(e)},handleHashchange:function(e){this.savePv(e)},savePv:function(e){try{if(!this.webMonitor)return;var t=this.webMonitor,n=e.from,r=e.to,o=te(n).relative,i=te(r).relative,a={simpleUrl:o||"/",referrer:i||"/"};t.logSave(I,a)}catch(e){}},handleUnhandleRejection:function(e){if(console.log("测试"),console.log(e),this.webMonitor){var t,n,r=this.webMonitor;t={type:z,message:(n=e.reason,M.isString(n)?n:JSON.stringify(n)),url:G(),name:e.type},E(e.reason)&&(t=a(a({},t),Z(e.reason)));var o={simpleUrl:G(),errorMessage:String(JSON.stringify(t))};r.logSave("js_error",o)}}};function Oe(e){U(e)}function Se(){if(Oe({callback:function(e){we.handleHistory(e)},type:"history"}),e=window.chrome,t=e&&e.app&&e.app.runtime,n="history"in window&&!!window.history.pushState&&!!window.history.replaceState,!t&&n){var e,t,n,r=window.onpopstate;window.onpopstate=function(){var e=G(),t=be;N("history",{from:t,to:e});for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];r&&r.apply(this,o)},P(window.history,"pushState",o),P(window.history,"replaceState",o)}function o(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n.length>2?n[2]:void 0;if(o){var i=be,a=String(o);be=a,N("history",{from:i,to:a})}return e.apply(this,n)}}}be=G();var xe=T(N,600);function Ue(t){var n,r;we.webMonitor=t,function(){if("XMLHttpRequest"in window){Oe({callback:function(e){we.handleHttp(e)},type:"xhr"});var t=XMLHttpRequest.prototype;P(t,"open",(function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.mito_xhr={method:M.isString(n[0])?n[0].toUpperCase():n[0],url:n[1]||"",type:"xhr",startTime:q()},e.apply(this,n)}})),P(t,"send",(function(t){return function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];k(this,"loadend",(function(){try{var t=this.responseType,n=this.response,o=this.status;this.mito_xhr.reqData=r[0];var i=q();this.mito_xhr.time=i,this.mito_xhr.status=o,-1!==["","json","text"].indexOf(t)&&(this.mito_xhr.responseText="object"===e(n)?JSON.stringify(n):n),this.mito_xhr.elapsedTime=i-this.mito_xhr.startTime,N("xhr",this.mito_xhr)}catch(e){}})),t.apply(this,r)}}))}}(),"fetch"in window&&(Oe({callback:function(e){we.handleHttp(e)},type:"fetch"}),P(window,"fetch",(function(e){return function(t,n){try{var r=q(),o={type:"fetch",method:n&&n.method||"GET",reqData:n&&n.body,url:t},i=new Headers(n&&n.headers||{});return Object.assign(i,{setRequestHeader:i.set}),n=a(a({},n),{},{headers:i}),e.apply(window,[t,n]).then((function(e){var t=e.clone(),n=q();return o=a(a({},o),{},{elapsedTime:n-r,status:t.status,time:n}),t.text().then((function(e){try{o.responseText="string"==typeof e?JSON.parse(e):""}catch(e){o.responseText=""}N("fetch",o)})),e}),(function(e){var t=q();throw N("fetch",o=a(a({},o),{},{elapsedTime:t-r,status:0,time:t})),e}))}catch(r){return e.apply(window,[t,n]).then((function(e){return e}),(function(e){throw e}))}}}))),Oe({callback:function(e){we.handleError(e)},type:"error"}),k(window,"error",(function(e){N("error",e)}),!0),Oe({callback:function(e){we.handleUnhandleRejection(e)},type:"unhandledrejection"}),k(window,"unhandledrejection",(function(e){N("unhandledrejection",e)})),Oe({callback:function(e){we.handleHashchange(e)},type:"hashchange"}),n=window,r="onpopstate",n.hasOwnProperty(r)||k(window,"hashchange",(function(e){N("hashchange",e)})),Se(),"document"in window&&(Oe({callback:function(e){!function(e){var t=e.tagName.toLowerCase();if("body"===t||"html"===t)return null;var n=e.classList.value;n=""!==n?' class="'.concat(n,'"'):"";var r=e.id?' id="'.concat(e.id,'"'):"",o=e.innerText;"<".concat(t).concat(r).concat(""!==n?n:"",">").concat(o,"</").concat(t,">")}(e.data.srcElement)},type:"dom"}),k(window.document,"click",(function(e){xe("dom",{category:"click",data:e})}),!0)),Oe({callback:function(e){we.handleUnhandleRejection(e)},type:"performance"}),window.onload=function(){window.performance||console.log("你的浏览器不支持 performance 接口")}}var Ne=function(e){s(o,d);var n=p(o);function o(){return t(this,o),n.apply(this,arguments)}return r(o,[{key:"reduceSynNumFun",value:function(){return o.instance.synNum--,this}},{key:"_fetch",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(n){try{var r=new XMLHttpRequest;r.open("POST","".concat(e.baseUrl).concat(e.api)),r.onreadystatechange=function(){4===r.readyState&&n()},r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.withCredentials=!0,r.send(JSON.stringify(t))}catch(e){n()}}))}}],[{key:"getInstance",value:function(e){return o.instance||(o.instance=new o(e)),o.instance}}]),o}(),Pe={baseUrl:"",autoReportApi:!0,autoReportPage:!0,autoReportPagePerformance:!0};var Te={init:function(e){this._init(e)}};(function(e){e._init=function(t){var n=this;t&&t.app||h.warn("[cloudMonitor] not set app"),t&&t.baseUrl||h.warn("[cloudMonitor] not set baseUrl");var r=Object.assign(Pe,t);n.$options=r,n.queue=Ne.getInstance(r.baseUrl),n.baseOptions="",n.referrerPage="",n.userId="",n.SOURCE_TYPE=1,n.optionsInit(r),Ue(e)}})(Te),ne(Te),oe(Te),ce(Te);var _e=ue,je=ve,Me=Te;export{je as aliMonitor,Me as webMonitor,_e as wxMonitor};
//# sourceMappingURL=index.js.map
