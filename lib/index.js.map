{"version":3,"file":"index.js","sources":["../src/util/index.js","../src/index.js"],"sourcesContent":["/**\n * 生成用户唯一标识码\n */\nfunction generateUUID() {\n    let uuid = '',\n      d = new Date().getTime()\n  \n    uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n      let r = (d + Math.random() * 16) % 16 | 0;\n      d = Math.floor(d / 16);\n      return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16)\n    })\n    \n    return uuid\n  }\n\nfunction getCwarn() {\n    let t = \"object\" == typeof console ? console.warn : noop;\n    try {\n        let e = {\n            warn: t\n        };\n        e.warn.call(e)\n    } catch (n) {\n        return noop\n    }\n    return t\n}\n\n/**\n * encodeURIComponent 转换\n * @param {*} t \n * @param {*} e \n */\nfunction encode(t, e) {\n    try {\n        t = e ? encodeURIComponent(t).replace(/\\(/g, \"%28\").replace(/\\)/g, \"%29\") : encodeURIComponent(t)\n    } catch (n) { }\n    return t\n}\n\n/**\n * 字符串替换\n * @param {*} str \n * @param {*} find \n * @param {*} replace \n */\nfunction replaceAll(str, find, replace) {\n    return str.replace(new RegExp(find, 'g'), replace);\n}\n\n\n/**\n * @param {*} t \n */\nfunction ext(t) {\n    for (let e = 1, n = arguments.length; e < n; e++) {\n        let r = arguments[e];\n        for (let o in r) {\n            Object.prototype.hasOwnProperty.call(r, o) && (t[o] = r[o])\n        }\n    }\n    return t\n}\n\nlet warn = getCwarn\n\nexport default {\n    ext,\n    warn,\n    encode,\n    replaceAll,\n    generateUUID\n}","import util from './util/index'\n\n/**\n * 监控\n */\nexport default class Monitor {\n    constructor() {\n        this._conf = {\n            baseUrl: '',\n            autoReportApi: true,\n            autoReportPage: true\n        }\n    }\n\n    /**\n     * 初始化参数\n     * @param {*} options \n     */\n    async setConfig(options) {\n\n    }\n\n    /**\n     * 监控执行\n     * @param {*} options \n     */\n    async init(options) {\n        if (!options || !options.pid) {\n            util.warn(\"[cloudMonitor] not set pid\");\n        }\n        let self = this\n        try {\n            await this.setConfig()\n            this.addHook()\n        } catch (err) {\n            util.warn(\"[cloudMonitor] set config error\");\n        }\n        // 是否需要落pv数据\n        if (this && this._conf && this._conf.autoReportPage) {\n            this.onReady(() => {\n                this._log('pv')\n            })\n        }\n        \n    }\n\n    /**\n     * @param {*} fun \n     */\n    onReady(fun) {\n        if (typeof fun != 'function') {\n            util.warn('[cloudMonitor] not function')\n            return\n        }\n        this._conf.uid ? fun() : setTimeout(() => {\n            this.onReady(fun)\n        }, 100)\n    }\n\n    /**\n     * 执行log 存储\n     * @param {*} type \n     */\n    _log(type) {\n\n    }\n\n    /**\n     * 代理\n     */\n    addHook() {\n\n    }\n\n    /**\n     * 监控注册\n     * @param {*} e \n     */\n    hookApp(e) {\n        let self = this,\n            t = {\n                onError: function (t) {\n                    let n = 1 === arguments.length ? [arguments[0]] : Array.apply(null, arguments),\n                        r = e.onError;\n                    try {\n                        self.error(t)\n                    } catch (t) {\n                        util.warn(\"[cloudMonitor] error in hookApp:onError\", t)\n                    }\n                    if (\"function\" == typeof r) {\n                        return r.apply(this, n)\n                    }\n                }\n            }\n\n        return util.ext({}, e, t)\n    }\n\n    /**\n     * 错误信息\n     * @param {*} t \n     * @param {*} e \n     */\n    error(t, e) {\n        if (!t) {\n            return util_1.warn(\"[cloudMonitor] invalid param e: \" + t), this\n        }\n        1 === arguments.length ? (\"string\" == typeof t && (t = {\n            message: t\n        }, e = {}), \"object\" == typeof t && (e = t = t.error || t)) : (\"string\" == typeof t && (t = {\n            message: t\n        }), \"object\" != typeof e && (e = {}));\n        let name = t.name || 'CustomError'\n        let useData = {\n            begin: Date.now(),\n            cate: name,\n            msg: t.message,\n            file: e.filename || \"\",\n            line: e.lineno || \"\",\n            col: e.colno || \"\",\n        }\n\n    }\n\n    getConfig(e) {\n        return {}\n        // return e ? this._conf[e] : util.ext({}, this._conf)\n    }\n}"],"names":["generateUUID","uuid","d","Date","getTime","replace","c","r","Math","random","floor","toString","getCwarn","t","console","warn","noop","e","call","n","encode","encodeURIComponent","replaceAll","str","find","RegExp","ext","arguments","length","o","Object","prototype","hasOwnProperty","Monitor","_conf","baseUrl","autoReportApi","autoReportPage","options","pid","util","setConfig","addHook","onReady","_log","fun","uid","setTimeout","type","self","onError","Array","apply","error","util_1","message","name","useData","begin","now","cate","msg","file","filename","line","lineno","col","colno"],"mappings":"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"}