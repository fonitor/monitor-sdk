{"version":3,"file":"index.js","sources":["../src/queue/base.js","../src/queue/wx.js","../src/util/mp-extend.js","../src/util/index.js","../src/log/wx.js","../src/index.js"],"sourcesContent":["\n/**\n * 消息队列 Base\n */\nexport default class Base {\n    constructor(baseUrl) {\n        this.baseUrl = baseUrl\n        this.requestQueue = [] // 队列\n        this.requestTimmer = undefined\n        this.synRequestNum = 4\n        this.synNum = 0\n        this.retryNum = 1 // 重试上报机制\n    }\n\n    /**\n     * 同步队列 （传入对象必须要有logType，logError）\n     * @param {*} log 队列日志\n     */\n    pushToQueue(log) {\n        {\n            // 简单先同步放入数组中\n            this.requestQueue.push(log)\n            return this.onReady(() => {\n                this.requestTimmer = this.delay(() => {\n                    this.clear()\n                }, this.requestQueue[0] && (!!this.requestQueue[0].logError && this.requestQueue[0].logError > 0) ? 3e3 : -1)\n            })\n        }\n    }\n\n    /**\n     * 宏任务（检测是否有唯一对应值）\n     * @param {*} fun\n     */\n    onReady(fun) {\n        if (typeof fun != 'function') {\n            return\n        }\n        // 检测是否有 openId 如果没有则延迟上报\n        if (fun) {\n            fun()\n        }\n    }\n\n    /**\n     * 执行队列\n     * @param {*} fun\n     * @param {*} e\n     */\n    delay(fun, e) {\n        if (!fun && typeof fun != 'function') return null\n        return e === -1 ? (fun(), null) : setTimeout(fun, e || 0)\n    }\n\n    /**\n     * 并发限制\n     * @return {?}\n     */\n    clear() {\n        var e\n        if (this.synNum > this.synRequestNum) {\n            return clearTimeout(this.requestTimmer), this.requestTimmer = setTimeout(() => {\n                this.clear()\n            }, 50)\n        }\n        for (clearTimeout(this.requestTimmer), this.requestTimmer = null; this.synNum < this.synRequestNum && (e = this.requestQueue.pop()); this.synNum++) {\n            this.handleLog(e)\n        }\n        // 执行完如果还有数据则继续执行（放到宏任务）\n        !!this.requestQueue.length && (this.requestTimmer = setTimeout(() => {\n            this.clear()\n        }, 50))\n\n    }\n\n    /**\n     * 清空队列\n     * @return {?}\n     */\n    clearAll() {\n        this.requestQueue = []\n        this.requestTimmer = null\n        this.synNum = 0\n    }\n\n    /**\n     * 并发数减一\n     * @return {?}\n     */\n    reduceSynNumFun() {\n        \n    }\n\n    /**\n     * 上报\n     * @param {*} e logType判断上传接口是哪种类型 pv：上报pv 逻辑 mv：上报mv逻辑 logError：0 代码重新上报次数0次，用int后续方便扩展\n     */\n    handleLog(e) {\n        // 深拷贝避免影响其他数据\n        let log = JSON.parse(JSON.stringify(e))\n        try {\n            this._fetch(log).then(_ => {\n                this.reduceSynNumFun()\n            })\n        } catch (err) {\n            this.reduceSynNumFun()\n        }\n    }\n\n    \n\n}","import Base from './base'\n\n/**\n * 适用于微信消息队列\n */\nexport default class wxQueue extends Base {\n\n    /**\n     * 单例\n     * @param {*} baseUrl\n     * @return {?}\n     */\n    static getInstance(baseUrl) {\n        if (!wxQueue.instance) {\n            wxQueue.instance = new wxQueue(baseUrl)\n        }\n        return wxQueue.instance\n    }\n\n    /**\n     * 并发数减一\n     * @return {?}\n     */\n    reduceSynNumFun() {\n        wxQueue.instance.synNum--\n        return this\n    }\n\n    _fetch(data = {}) {\n        return new Promise(resolve => {\n            wx.request({\n                url: `${this.baseUrl}/api/save/log`,\n                data: data,\n                method: 'POST',\n                dataType: 'json',\n                fail: (res) => {},\n                complete: (res) => {\n                    resolve()\n                }\n            })\n        })\n    }\n}","// 可以用于拓展的生命周期\nconst life = {\n    App: ['preprocess', 'onLaunch', 'onShow', 'onHide', 'onError'],\n    Page: ['preprocess', 'onLoad', 'onReady', 'onShow', 'onHide', 'onUnload', 'onPullDownRefresh', 'onReachBottom', 'onShareAppMessage'],\n    Component: ['preprocess', 'created', 'attached', 'ready', 'moved', 'detached', 'error']\n}\n\n// 用于保存所有的拓展生命周期函数\nlet lifeMixin = {}\nfor (let key in life) {\n    lifeMixin[key] = lifeMixin[key] || {}\n    for (let lifeTime of life[key]) {\n        lifeMixin[key][lifeTime] = []\n    }\n}\n\n// 基类对象\n// 在调用App、Page、Component前会被混入到对象中\nlet base = {\n    App: {},\n    Page: {},\n    Component: {}\n}\n\nlet MpExtend = function (param) {\n    // 允许接收数组形式的参数\n    if (isArray(param)) {\n        param.forEach(item => MpExtend(item))\n        return\n    }\n\n    for (const constructorName in param) {\n        // constructorName 应当是[App, Page, Component] 中的一个\n        if (!life[constructorName]) {\n            warning(constructorName, 'not found')\n            continue\n        }\n\n        const option = Object.assign({}, param[constructorName])\n        // 如果是生命周期中的某一个，作为生命周期拓展\n        for (const key in option) {\n            if (lifeMixin[constructorName][key]) {\n                lifeMixin[constructorName][key].push(option[key])\n                delete option[key]\n            }\n        }\n        // 把剩余的属性混入到基类中\n        mixin(base[constructorName], option)\n    }\n}\n\n// 重新包装的 App、Page、Component构造函数\n// 虽然都是相似的代码但是这样更利于理解和修改\nconst _App = decorate(App, function (option) {\n    mixin(option, base.App)\n    for (const lifeTime of life.App) {\n        option[lifeTime] = decorate(option[lifeTime], ...lifeMixin.App[lifeTime])\n    }\n    option['preprocess'] && option['preprocess'].call(option, option)\n})\n\nconst _Page = decorate(Page, function (option) {\n    mixin(option, base.Page)\n    for (const lifeTime of life.Page) {\n        option[lifeTime] = decorate(option[lifeTime], ...lifeMixin.Page[lifeTime])\n    }\n    option['preprocess'] && option['preprocess'].call(option, option)\n})\n\nconst _Component = decorate(Component, function (option) {\n    mixin(option, base.Component)\n    for (const lifeTime of life.Component) {\n        option[lifeTime] = decorate(option[lifeTime], ...lifeMixin.Component[lifeTime])\n    }\n    option['preprocess'] && option['preprocess'].call(option, option)\n})\n\n// 装饰函数\n// 在调用原函数之前调用所有装饰器\nfunction decorate(f, ...decorators) {\n    return function () {\n        for (const decorator of decorators) {\n            decorator && decorator.apply(this, arguments)\n        }\n        return f && f.apply(this, arguments)\n    }\n}\n\n/**\n * 实现类似混入的效果\n * 类似 Object.assign， 但在遇见相同属性名均是对象时会递归进行合并而非直接覆盖\n * @param o\n * @param mix 可以传入多个\n * 注：如果存在引用循环递归会栈溢出\n */\nfunction mixin(o, ...mixs) {\n    mixs.forEach(mix => {\n        for (const key in mix) {\n            // 两个属性都是对象则递归合并\n            if (isObject(o[key]) && isObject(mix[key])) {\n                mixin(o[key], mix[key])\n            } else {\n                o[key] = o[key] || mix[key]\n            }\n        }\n        // 拷贝symbol类型，（可惜小程序不支持）\n        for (const sym of Object.getOwnPropertySymbols(mix)) {\n            o[sym] = o[sym] || mix[sym]\n        }\n    })\n    return o\n}\n\nfunction isObject(o) {\n    return Object.prototype.toString.call(o) === \"[object Object]\"\n}\n\nfunction isArray(o) {\n    return Object.prototype.toString.call(o) === \"[object Array]\"\n}\n\nfunction warning(...msg) {\n    MpExtend.tips && console.warn('mp-extend:', ...msg)\n}\n\nObject.assign(MpExtend, {\n    mixin,\n    decorate,\n    App: _App,\n    Page: _Page,\n    Component: _Component,\n    warning,\n    tips: true\n})\nexport default MpExtend","/**\n * 生成用户唯一标识码\n */\nfunction generateUUID() {\n    let uuid = '',\n      d = new Date().getTime()\n  \n    uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n      let r = (d + Math.random() * 16) % 16 | 0;\n      d = Math.floor(d / 16);\n      return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16)\n    })\n    \n    return uuid\n  }\n\nfunction getCwarn() {\n    let t = \"object\" == typeof console ? console.warn : noop;\n    try {\n        let e = {\n            warn: t\n        };\n        e.warn.call(e)\n    } catch (n) {\n        return noop\n    }\n    return t\n}\n\n/**\n * encodeURIComponent 转换\n * @param {*} t \n * @param {*} e \n */\nfunction encode(t, e) {\n    try {\n        t = e ? encodeURIComponent(t).replace(/\\(/g, \"%28\").replace(/\\)/g, \"%29\") : encodeURIComponent(t)\n    } catch (n) { }\n    return t\n}\n\n/**\n * 字符串替换\n * @param {*} str \n * @param {*} find \n * @param {*} replace \n */\nfunction replaceAll(str, find, replace) {\n    return str.replace(new RegExp(find, 'g'), replace);\n}\n\n\n/**\n * @param {*} t \n */\nfunction ext(t) {\n    for (let e = 1, n = arguments.length; e < n; e++) {\n        let r = arguments[e];\n        for (let o in r) {\n            Object.prototype.hasOwnProperty.call(r, o) && (t[o] = r[o])\n        }\n    }\n    return t\n}\n\n/**\n * 日期格式化\n * @param {*} date \n * @param {*} fmt \n */\nfunction dateFormat(date, fmt) {\n\tif (!date || !(date instanceof Date)) {\n\t\treturn \"\";\n\t}\n\tvar o = {\n\t\t\"M+\": date.getMonth() + 1, // 月份\n\t\t\"d+\": date.getDate(), // 日\n\t\t\"h+\": date.getHours(), // 小时\n\t\t\"m+\": date.getMinutes(), // 分\n\t\t\"s+\": date.getSeconds(), // 秒\n\t\t\"q+\": Math.floor((date.getMonth() + 3) / 3), // 季度\n\t\t\"S\": date.getMilliseconds() // 毫秒\n\t};\n\tif (/(y+)/.test(fmt))\n\t\tfmt = fmt.replace(RegExp.$1, (date.getFullYear() + \"\").substr(4 - RegExp.$1.length));\n\tfor (var k in o)\n\t\tif (new RegExp(\"(\" + k + \")\").test(fmt))\n\t\t\tfmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : ((\"00\" + o[k]).substr((\"\" + o[k]).length)));\n\treturn fmt;\n}\n\nlet warn = getCwarn\n\nexport default {\n    ext,\n    warn,\n    encode,\n    replaceAll,\n    generateUUID,\n    dateFormat\n}","\nimport wxQueue from '../queue/wx'\nimport mpExtend from '../util/mp-extend'\nimport util from '../util/index'\nconst baseConfig = {\n    baseUrl: '',\n    autoReportApi: true, // 是否上报api \n    autoReportPage: true, // 是否上报页面信息\n    autoReportPagePerformance: true, // 是否上报页面性能\n}\n\nmpExtend.baseOptions = '' // 初始化上传参数\nmpExtend.referrerPage = '' // 上一个页面\nmpExtend.pageKey = '' // 用户标识\n\nconst type = 2 // 代表微信小程序\nconst projectVersion = '1.0.0' // 项目版本号\n\n/**\n * 设置用户标识\n * @param {*} key \n */\nmpExtend.setPageKey = function(key) {\n    mpExtend.pageKey = key\n}\n\n\n/**\n * 初始化上传参数\n * @param {*} option \n */\nfunction initBaseOptions(option) {\n    // 初始化上传参数\n    wx.getSystemInfo({\n        success: (res) => {\n            mpExtend.baseOptions = {\n                app: option.app || \"\",\n                type, // 代表微信小程序\n                projectVersion: option.projectVersion || projectVersion, // 项目版本号\n                customerKey: util.generateUUID(), // 会话id\n                os: res.system.indexOf('iOS') === -1 ? 'Android' : 'IOS', // 系统信息\n                deviceName: res.model, // 手机型号\n                brand: res.brand, // 手机品牌\n                browserVersion: res.version, // 小程序版本号\n            }\n        }\n    });\n    \n}\n\n/**\n * 获取当前url\n */\nfunction getPage() {\n    return getCurrentPages()[getCurrentPages().length - 1].__route__\n}\n\n\n/**\n * 上传日志\n * @param {*} type \n * @param {*} data \n */\nfunction logSave(type, data) {\n    let useData,\n        logData = JSON.parse(JSON.stringify(data))\n    if (!mpExtend.baseOptions) {\n        initBaseOptions(mpExtend.options)\n        setTimeout(() => {\n            logSave(type, data)\n        }, 500)\n        return\n    }\n    switch (type) {\n        case 'page_pv':\n            useData = Object.assign(logData, mpExtend.baseOptions)\n            useData.userId = mpExtend.userId || \"\", // 用户标识\n            useData.uploadType = type\n            useData.mobileTime = util.dateFormat(new Date(), 'yyyy-MM-dd hh:mm:ss')\n            mpExtend.queue.pushToQueue(useData)\n            break\n        case 'js_error':\n            useData = Object.assign(logData, mpExtend.baseOptions)\n            useData.userId = mpExtend.userId || \"\", // 用户标识\n            useData.uploadType = type\n            useData.mobileTime = util.dateFormat(new Date(), 'yyyy-MM-dd hh:mm:ss')\n            mpExtend.queue.pushToQueue(useData)\n            break\n        case 'http_log':\n            useData = Object.assign(logData, mpExtend.baseOptions)\n            useData.userId = mpExtend.userId || \"\", // 用户标识\n            useData.uploadType = type\n            useData.mobileTime = util.dateFormat(new Date(), 'yyyy-MM-dd hh:mm:ss')\n            mpExtend.queue.pushToQueue(useData)\n            break\n        default:\n\n    }\n}\n\nconst addHook = function (options) {\n    if (wx && options && options.autoReportApi) {\n        let startTime = new Date().getTime()\n        wx._request = function (e) {\n            let _e = e\n            let _fail = _e.fail || \"\",\n                _success = _e.success || \"\",\n                _complete = _e.complete || \"\"\n            _e.fail = function (error) {\n                !!_fail && _fail(error)\n                try {\n                    let data = {\n                        httpUrl: e.url,\n                        httpUploadType: 2,\n                        responseText: JSON.stringify(error),\n                    }\n                    logSave('http_log', data)\n                } catch (e) {\n                    util.warn('[cloudMonitor] http error')\n                }\n            }\n            _e.success = function (success) {\n                !!_success && _success(success)\n                try {\n                    // 上报接口报警\n                    if (!!success && success.statusCode && success.statusCode != 200) {\n                        let data = {\n                            httpUrl: _e.url,\n                            httpUploadType: 2,\n                            responseText: JSON.stringify(success),\n                        }\n                        logSave('http_log', data)\n                    } else {\n                        let endTime = new Date().getTime()\n                        let consumeData = {\n                            loadTime: endTime - startTime,\n                            httpUrl: _e.url,\n                            httpUploadType: 1,\n                            responseText: JSON.stringify(success),\n                        }\n                        logSave('http_log', consumeData)\n                    }\n                } catch (e) {\n                    util.warn('[cloudMonitor] http error')\n                }\n            }\n            _e.complete = function (complete) {\n                !!_complete && _complete(complete)\n            }\n            wx.request(_e)\n        }\n    }\n}\n\nconst performanceInit = function () {\n    if (wx.canIUse('getPerformance')) {\n        const performance = wx.getPerformance()\n        const observer = performance.createObserver((entryList) => {\n            let res = entryList.getEntries() || []\n            if (res.length == 0) {\n                return\n            }\n            res.forEach((item) => {\n                if (item) {\n                    let {\n                        entryType = '', duration = 0, name = '', path = '', moduleName = ''\n                    } = item\n                    if (entryType == 'render' && duration && path) {\n                        log.reportPerformance(trackRenderPerformance['render'], duration, path)\n                        log.reportPerformance(trackRenderPerformance['firstRender'], duration, path)\n                    } else if (entryType == 'navigation' && duration && path) {\n                        log.reportPerformance(trackRenderPerformance['navigation'], duration, path)\n                        if (name == 'appLaunch') {\n                            log.reportPerformance(trackRenderPerformance['appLaunch'], duration, path)\n                        } else if (name == 'route') {\n                            log.reportPerformance(trackRenderPerformance['route'], duration, path)\n                        }\n                    } else if (entryType == 'script' && duration && moduleName) {\n                        log.reportPerformance(trackRenderPerformance['evaluateScript'], duration, moduleName)\n                    }\n                }\n            })\n        })\n        observer.observe({\n            entryTypes: ['navigation', 'render', 'script']\n        })\n    } else {\n        return\n    }\n}\n\nconst memoryWarning = () => {\n    if (wx.canIUse('onMemoryWarning')) {\n        try {\n            wx.onMemoryWarning((res) => {\n                let level = 1,\n                    route = '';\n\n                if (!!res && !!res.level) {\n                    level = res.level\n                }\n                let pages = getCurrentPages()\n                if (pages && pages.length > 0) {\n                    route = getCurrentPages()[getCurrentPages().length - 1].__route__\n                    log.reportPerformance(trackRenderPerformance['memoryWarning'], level, route)\n                }\n            })\n        } catch (error) {\n\n        }\n    }\n}\n\nlet pagesPerformance = function (options) {\n    if (!options || !options.autoReportPagePerformance) {\n        return\n    }\n\n}\n\nconst defaultInit = {\n    App: {\n        onError(e) {\n            try {\n                let data = {\n                    simpleUrl: getPage(),\n                    errorMessage: String(e)\n                }\n                logSave('js_error', data)\n            }catch(err) {\n                util.warn('[cloudMonitor] JavaScript error')\n            }\n           \n        }\n    },\n    Page: {\n        onShow() {\n            if (mpExtend.options.autoReportPage) {\n                try {\n                    let data = {\n                        simpleUrl: this.__route__,\n                        referrer: mpExtend.referrerPage,\n                    }\n                    logSave('page_pv', data)\n                    mpExtend.referrerPage = this.__route__\n                } catch (err) {\n                    \n                }\n            }\n        }\n    }\n}\n\n/**\n * 初始化参数\n * @param {*} options \n */\nmpExtend.init = function (options) {\n    if (!options || !options.app) {\n        util.warn('[cloudMonitor] not set app')\n    }\n    if (!options || !options.baseUrl) {\n        util.warn('[cloudMonitor] not set baseUrl')\n    }\n    let _options = Object.assign(baseConfig, options)\n    this.options = _options\n    addHook(_options)\n    pagesPerformance(_options)\n    initBaseOptions(_options)\n    // 初始化消息队列\n    mpExtend.queue = wxQueue.getInstance(_options.baseUrl)\n}\n\nmpExtend(defaultInit)\n\nexport default mpExtend","import wxMonitor from './log/wx'\n\n/**\n * 监控导出\n */\nexport default {\n    wxMonitor\n}"],"names":["Base","baseUrl","requestQueue","requestTimmer","undefined","synRequestNum","synNum","retryNum","log","push","onReady","delay","clear","logError","fun","e","setTimeout","clearTimeout","pop","handleLog","length","JSON","parse","stringify","_fetch","then","_","reduceSynNumFun","err","wxQueue","instance","data","Promise","resolve","wx","request","url","method","dataType","fail","res","complete","life","App","Page","Component","lifeMixin","key","lifeTime","base","MpExtend","param","isArray","forEach","item","constructorName","warning","option","Object","assign","mixin","_App","decorate","call","_Page","_Component","f","decorators","decorator","apply","arguments","o","mixs","mix","isObject","getOwnPropertySymbols","sym","prototype","toString","msg","tips","console","warn","generateUUID","uuid","d","Date","getTime","replace","c","r","Math","random","floor","getCwarn","t","noop","n","encode","encodeURIComponent","replaceAll","str","find","RegExp","ext","hasOwnProperty","dateFormat","date","fmt","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","test","$1","getFullYear","substr","k","baseConfig","autoReportApi","autoReportPage","autoReportPagePerformance","mpExtend","baseOptions","referrerPage","pageKey","type","projectVersion","setPageKey","initBaseOptions","getSystemInfo","success","app","customerKey","util","os","system","indexOf","deviceName","model","brand","browserVersion","version","getPage","getCurrentPages","__route__","logSave","useData","logData","options","userId","uploadType","mobileTime","queue","pushToQueue","addHook","startTime","_request","_e","_fail","_success","_complete","error","httpUrl","httpUploadType","responseText","statusCode","endTime","consumeData","loadTime","pagesPerformance","defaultInit","onError","simpleUrl","errorMessage","String","onShow","referrer","init","_options","getInstance","wxMonitor"],"mappings":"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"}